include: "rules/common.smk"


##### 1. Extract information from config file
(
    DF_PROJECTS,
    DF_SAMPLES,
    PROKKA_DB_TABLE,
    PROKKA_DB_MAP,
    PEP_PROJECTS,
) = extract_project_information(config)

# generate centralized sample datasets
bgcflow_util_dir = Path("data/interim/bgcflow_utils")
bgcflow_util_dir.mkdir(parents=True, exist_ok=True)
DF_SAMPLES.to_csv(bgcflow_util_dir / "samples.csv", index=False)

##### 2. Generate wildcard constants #####
STRAINS = DF_SAMPLES.genome_id.to_list()
NCBI = DF_SAMPLES[DF_SAMPLES.source.eq("ncbi")].genome_id.to_list()

##### 3. Wildcard constraints #####
wildcard_constraints:
    strains="|".join(STRAINS),

##### Target rules #####

rule all:
    input:
        expand("data/interim/defense_finder/{strains}/", strains=STRAINS),


##### Modules #####
include: "rules/defense-finder.smk"
include: "rules/prokka.smk"
include: "rules/ncbi.smk"